# JSON Schema for ProjSpec State Files
# Used for validation of state.yaml, config.yaml, workflow.yaml
# Version: 1.0

---
# TaskState Schema
TaskState:
  type: object
  required:
    - id
    - name
    - status
  properties:
    id:
      type: string
      pattern: "^task-[0-9]{3}$"
      description: Unique task identifier
    name:
      type: string
      minLength: 1
      maxLength: 100
      description: Human-readable task name
    description:
      type: string
      default: ""
      description: Detailed task description
    status:
      type: string
      enum:
        - pending
        - in_progress
        - completed
        - skipped
      default: pending
      description: Current task status
    depends_on:
      type: array
      items:
        type: string
        pattern: "^task-[0-9]{3}$"
      default: []
      description: Task IDs that must complete first
    context_files:
      type: array
      items:
        type: string
      default: []
      description: Glob patterns for relevant files
    summary:
      type: string
      nullable: true
      default: null
      description: 3-5 bullet summary after completion

---
# SpecState Schema
SpecState:
  type: object
  required:
    - spec_id
    - name
    - phase
    - created_at
    - branch
    - worktree_path
  properties:
    spec_id:
      type: string
      pattern: "^[a-f0-9]{8}$"
      description: 8-character hex ID
    name:
      type: string
      pattern: "^[a-z0-9-]+$"
      minLength: 1
      maxLength: 50
      description: Kebab-case spec name
    phase:
      type: string
      enum:
        - new
        - spec
        - plan
        - tasks
        - implement
        - review
      description: Current workflow phase
    created_at:
      type: string
      format: date-time
      description: ISO 8601 timestamp
    branch:
      type: string
      pattern: "^spec/[a-f0-9]{8}-[a-z0-9-]+$"
      description: Git branch name
    worktree_path:
      type: string
      pattern: "^worktrees/spec-[a-f0-9]{8}-[a-z0-9-]+$"
      description: Relative path to worktree
    tasks:
      type: array
      items:
        $ref: "#/TaskState"
      default: []
      description: Tasks for implementation

---
# Config Schema
Config:
  type: object
  required:
    - version
  properties:
    version:
      type: string
      pattern: "^[0-9]+\\.[0-9]+$"
      description: Config schema version
    project:
      type: object
      properties:
        name:
          type: string
          description: Project display name
        description:
          type: string
          default: ""
          description: Project description
    worktrees:
      type: object
      properties:
        base_path:
          type: string
          default: "./worktrees"
          description: Directory for worktrees
    context:
      type: object
      properties:
        always_include:
          type: array
          items:
            type: string
          default:
            - "CLAUDE.md"
          description: Files always in context

---
# Workflow Schema
Workflow:
  type: object
  required:
    - workflow
  properties:
    workflow:
      type: object
      required:
        - name
        - phases
      properties:
        name:
          type: string
          default: default
          description: Workflow identifier
        phases:
          type: array
          items:
            type: string
          minItems: 1
          description: Ordered phase names

---
# CLI Output Contracts

InitOutput:
  type: object
  description: Output from projspec init
  properties:
    success:
      type: boolean
    message:
      type: string
    directories_created:
      type: array
      items:
        type: string

StatusOutput:
  type: object
  description: Output from projspec status
  properties:
    specs:
      type: array
      items:
        type: object
        properties:
          spec_id:
            type: string
          name:
            type: string
          phase:
            type: string
          branch:
            type: string
          worktree_path:
            type: string
          task_progress:
            type: object
            properties:
              total:
                type: integer
              completed:
                type: integer
              in_progress:
                type: integer
              pending:
                type: integer
