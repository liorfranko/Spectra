---
description: Create a structured specification document from brief.md
---

# /projspec.spec Command

This command guides the user through creating a structured specification document (spec.md) based on their brief.md input. It transforms an informal feature description into a complete, structured specification.

## Prerequisites

- A spec must exist and be in the "new" phase
- The brief.md file should be populated with the feature description
- User should be in the spec's worktree or the main repository

## Execution Steps

Follow these steps exactly to create the specification document:

### Step 1: Detect Current Spec

Find the active spec by listing the `.projspec/specs/active/` directory:

```bash
ls .projspec/specs/active/
```

If the directory is empty or doesn't exist, output this error and stop:

```
Error: No active specs found.

Create a new spec first with: /projspec.new <spec-name>
```

If multiple specs are found, list them and ask the user which one to use:

```
Multiple active specs found:
- {SPEC_ID_1}: {SPEC_NAME_1} (phase: {PHASE_1})
- {SPEC_ID_2}: {SPEC_NAME_2} (phase: {PHASE_2})

Which spec would you like to create a specification for? Please provide the spec ID.
```

### Step 2: Load State Configuration

Read the state.yaml file for the selected spec:

```bash
cat .projspec/specs/active/{SPEC_ID}/state.yaml
```

Parse the YAML to extract:
- `SPEC_ID`: The spec identifier
- `SPEC_NAME`: The spec name
- `PHASE`: Current phase
- `WORKTREE_PATH`: Path to the worktree

### Step 3: Verify Phase is "new"

Check that the current phase is "new". If not, handle accordingly:

**If phase is "spec" or later:**
```
This spec already has a specification document.

Current phase: {PHASE}
Spec file: {WORKTREE_PATH}/specs/{SPEC_ID}/spec.md

Would you like to:
1. View the existing spec.md
2. Regenerate the spec.md (this will overwrite the existing file)

Please choose an option.
```

If the user chooses option 2, proceed with the remaining steps to regenerate.

### Step 4: Read brief.md

Read the brief file from the worktree:

```bash
cat {WORKTREE_PATH}/specs/{SPEC_ID}/brief.md
```

If the file doesn't exist or is empty, output this error:

```
Error: brief.md not found or empty at {WORKTREE_PATH}/specs/{SPEC_ID}/brief.md

Please create and populate the brief.md file with your feature description, then run this command again.
```

### Step 5: Analyze Brief and Ask Clarifying Questions

Review the brief.md content and identify any areas that need clarification. Ask up to 5 targeted clarifying questions to fill gaps in:

- Problem understanding (who, what, why)
- User roles and their needs
- Technical constraints or requirements
- Success metrics and acceptance criteria
- Scope boundaries

**Clarification Format:**

```
I've reviewed your brief for "{SPEC_NAME}". Before creating the specification, I have a few clarifying questions:

1. [Question about unclear aspect]
2. [Question about missing information]
3. [Question about scope or constraints]

Please provide your answers, or type "skip" if you'd like me to proceed with reasonable assumptions.
```

Wait for user responses before proceeding. If the user provides answers, incorporate them into the specification.

### Step 6: Create spec.md

Create the specification document at `{WORKTREE_PATH}/specs/{SPEC_ID}/spec.md` with the following structure.

**Important:** Replace all placeholders with actual content derived from the brief.md and clarification answers. Do NOT leave placeholder text.

```markdown
# {SPEC_NAME} Specification

> Auto-generated by /projspec.spec from brief.md

---

## Problem Statement

<!-- What problem are we solving? Why does it matter? -->

- **Context**: [Describe the current situation or background based on brief]
- **Pain Point**: [Extract the specific problem or limitation from brief]
- **Impact**: [Articulate why solving this matters, the value it provides]

---

## User Stories

<!-- Who uses this and what do they need? -->

### Primary Users

| Role | Story | Priority |
|------|-------|----------|
| [User role from brief] | As a [role], I want [capability] so that [benefit] | High/Medium/Low |

### Additional Stories

- [ ] [Additional user story derived from requirements]
- [ ] [Additional user story derived from requirements]

---

## Technical Requirements

<!-- What capabilities are needed? -->

### Functional Requirements

1. **[Category derived from brief]**
   - [ ] [Specific requirement from brief]
   - [ ] [Specific requirement from brief]

2. **[Category derived from brief]**
   - [ ] [Specific requirement from brief]
   - [ ] [Specific requirement from brief]

### Non-Functional Requirements

- **Performance**: [Performance expectations if mentioned, or "N/A"]
- **Security**: [Security considerations if mentioned, or "N/A"]
- **Compatibility**: [Compatibility requirements if mentioned, or "N/A"]

---

## Success Criteria

<!-- How do we know we're done? -->

### Acceptance Criteria

- [ ] [Specific, testable criterion from brief]
- [ ] [Specific, testable criterion from brief]
- [ ] [Specific, testable criterion from brief]

### Definition of Done

- [ ] All acceptance criteria met
- [ ] Code reviewed and approved
- [ ] Tests passing
- [ ] Documentation updated

---

## Out of Scope

<!-- What are we explicitly NOT doing? -->

The following items are intentionally excluded from this project:

- [Item explicitly not included based on brief or clarifications]
- [Future consideration that is deferred]

---

## Open Questions

<!-- What needs clarification before or during implementation? -->

| Question | Owner | Status | Resolution |
|----------|-------|--------|------------|
| [Any remaining unclear points] | [Who can answer] | Open | [To be resolved] |

---

## References

- Source: specs/{SPEC_ID}/brief.md
- [Any other references mentioned in brief]

---

**Phase Checklist**

Before moving to the planning phase, ensure:

- [ ] Problem statement is clear and agreed upon
- [ ] All primary user stories are captured
- [ ] Technical requirements are specific enough to plan
- [ ] Success criteria are measurable
- [ ] Scope boundaries are defined
- [ ] Open questions are documented
```

### Step 7: Update state.yaml

Update the phase in state.yaml from "new" to "spec":

Read the current state.yaml:
```bash
cat .projspec/specs/active/{SPEC_ID}/state.yaml
```

Modify the `phase` field from `new` to `spec` and write the updated content back to the file.

### Step 8: Output Success Message

Report success to the user:

```
Specification created successfully!

  Spec ID:    {SPEC_ID}
  Name:       {SPEC_NAME}
  Phase:      new -> spec
  Spec file:  {WORKTREE_PATH}/specs/{SPEC_ID}/spec.md

The specification document has been created with the following sections:
- Problem Statement
- User Stories
- Technical Requirements
- Success Criteria
- Out of Scope
- Open Questions

Next steps:
  1. Review the spec.md file and refine as needed
  2. When ready, run: /projspec.plan to create the implementation plan
```

## Error Handling

If any step fails:
- For missing brief.md: Guide user to create and populate the file
- For state.yaml read errors: Check file permissions and path
- For phase errors: Explain current phase and available options
- For file write errors: Check directory permissions

Report the specific error and suggest remediation steps.

## Example Usage

```
User: /projspec.spec

Claude:
1. Detects spec a1b2c3d4 (user-auth) in "new" phase
2. Reads brief.md content
3. Asks 2-3 clarifying questions
4. User provides answers
5. Creates spec.md with structured content
6. Updates state.yaml phase to "spec"
7. Reports success with next steps
```

## Notes

- The spec.md content should be derived from brief.md, not copied verbatim
- Transform informal descriptions into structured requirements
- User stories should follow the "As a [role], I want [capability] so that [benefit]" format
- Success criteria should be specific and testable
- Out of scope should explicitly list what is NOT included
- Open questions capture anything needing further clarification
